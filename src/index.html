<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Washing Line Predictor</title>
    <meta name="description" content="Smart washing line predictor using real Met Office weather data to tell you the best times to hang out washing.">
    <meta name="keywords" content="washing, weather, forecast, met office, drying, laundry">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .location-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            border-color: #667eea;
        }

        button {
            padding: 15px 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .fabric-selector {
            margin-bottom: 20px;
            text-align: center;
        }

        .fabric-selector label {
            display: inline-block;
            margin-right: 15px;
            font-weight: 600;
            color: #333;
        }

        .fabric-selector select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .api-status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .api-live {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .api-demo {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            color: #721c24;
        }

        .results {
            margin-top: 30px;
        }

        .best-times {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .best-times h2 {
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .time-slot {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .time-slot.excellent {
            background: rgba(0, 184, 148, 0.8);
            border: 2px solid #00b894;
        }

        .time-slot.good {
            background: rgba(253, 203, 110, 0.8);
            border: 2px solid #fdcb6e;
            color: #2d3436;
        }

        .time-slot.poor {
            background: rgba(231, 76, 60, 0.8);
            border: 2px solid #e74c3c;
        }

        .time-info {
            margin-top: 10px;
            font-size: 0.9em;
        }

        .time-info div {
            margin-bottom: 5px;
        }

        .drying-estimate {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
        }

        .safe-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .safe-yes {
            background: rgba(0, 184, 148, 0.2);
            color: #00b894;
            border: 1px solid #00b894;
        }

        .safe-partial {
            background: rgba(253, 203, 110, 0.2);
            color: #e17055;
            border: 1px solid #fdcb6e;
        }

        .wind-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.9);
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .wind-bars {
            display: flex;
            align-items: end;
            gap: 2px;
            height: 16px;
        }

        .wind-bar {
            width: 3px;
            background: #ddd;
            border-radius: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .wind-bar.active {
            background: #2c3e50;
        }

        /* Calm - Light Blue/Teal */
        .wind-level-1 .wind-bar:nth-child(1) { height: 4px; background: #16a085; box-shadow: 0 1px 3px rgba(22,160,133,0.3); }

        /* Light Breeze - Green */
        .wind-level-2 .wind-bar:nth-child(1) { height: 4px; background: #27ae60; box-shadow: 0 1px 3px rgba(39,174,96,0.3); }
        .wind-level-2 .wind-bar:nth-child(2) { height: 8px; background: #2ecc71; box-shadow: 0 1px 3px rgba(46,204,113,0.3); }

        /* Moderate - Yellow/Orange */
        .wind-level-3 .wind-bar:nth-child(1) { height: 4px; background: #f1c40f; box-shadow: 0 1px 3px rgba(241,196,15,0.3); }
        .wind-level-3 .wind-bar:nth-child(2) { height: 8px; background: #f39c12; box-shadow: 0 1px 3px rgba(243,156,18,0.3); }
        .wind-level-3 .wind-bar:nth-child(3) { height: 12px; background: #e67e22; box-shadow: 0 1px 3px rgba(230,126,34,0.3); }

        /* Strong Breeze - Orange/Red */
        .wind-level-4 .wind-bar:nth-child(1) { height: 4px; background: #e67e22; box-shadow: 0 1px 3px rgba(230,126,34,0.3); }
        .wind-level-4 .wind-bar:nth-child(2) { height: 8px; background: #d35400; box-shadow: 0 1px 3px rgba(211,84,0,0.3); }
        .wind-level-4 .wind-bar:nth-child(3) { height: 12px; background: #e74c3c; box-shadow: 0 1px 3px rgba(231,76,60,0.3); }
        .wind-level-4 .wind-bar:nth-child(4) { height: 16px; background: #c0392b; box-shadow: 0 1px 3px rgba(192,57,43,0.3); }

        /* Strong Wind - Deep Red/Purple */
        .wind-level-5 .wind-bar:nth-child(1) { height: 4px; background: #e74c3c; box-shadow: 0 1px 3px rgba(231,76,60,0.3); }
        .wind-level-5 .wind-bar:nth-child(2) { height: 8px; background: #c0392b; box-shadow: 0 1px 3px rgba(192,57,43,0.3); }
        .wind-level-5 .wind-bar:nth-child(3) { height: 12px; background: #a93226; box-shadow: 0 1px 3px rgba(169,50,38,0.3); }
        .wind-level-5 .wind-bar:nth-child(4) { height: 16px; background: #922b21; box-shadow: 0 1px 3px rgba(146,43,33,0.3); }
        .wind-level-5 .wind-bar:nth-child(5) { height: 20px; background: #7b241c; box-shadow: 0 1px 3px rgba(123,36,28,0.3); }

        .wind-description {
            font-size: 0.85em;
            color: #2c3e50;
            font-weight: 600;
            margin-left: 3px;
        }

        .wind-speed {
            font-weight: 600;
            color: #2c3e50;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .day-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .day-card:hover {
            transform: translateY(-5px);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .weather-icon {
            font-size: 2em;
            margin-right: 10px;
        }

        .washing-score {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .score-excellent {
            background: #00b894;
            color: white;
        }

        .score-good {
            background: #fdcb6e;
            color: #2d3436;
        }

        .score-fair {
            background: #fd79a8;
            color: white;
        }

        .score-poor {
            background: #e17055;
            color: white;
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tips {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .tips h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .tips ul {
            list-style-type: none;
            padding-left: 0;
        }

        .tips li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .tips li:before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .location-input {
                flex-direction: column;
            }

            .forecast-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß∫ Smart Washing Line Predictor</h1>

        <div class="location-input">
            <input type="text" id="locationInput" placeholder="Enter your city (e.g., London, Birmingham, Manchester)" value="Birmingham, UK">
            <button onclick="getWeatherForecast()">Get Washing Forecast</button>
        </div>

        <div class="fabric-selector">
            <label for="fabricType">Fabric type:</label>
            <select id="fabricType" onchange="getWeatherForecast()">
                <option value="cotton">Cotton (T-shirts, underwear)</option>
                <option value="thick">Heavy items (Jeans, towels)</option>
                <option value="delicate">Delicate/Synthetic</option>
                <option value="bedding">Bedding (Sheets, duvet covers)</option>
            </select>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // ========================================
        // WEATHER API CONFIGURATION
        // ========================================
        // Using OpenWeatherMap API (browser-friendly with CORS support)
        // TODO: Replace with your actual OpenWeatherMap API key
        const WEATHER_API_KEY = 'YOUR_API_KEY_HERE';
        
        // OpenWeatherMap API endpoints
        const OPENWEATHER_BASE_URL = 'https://api.openweathermap.org/data/2.5';
        const CURRENT_WEATHER_ENDPOINT = '/weather';
        const FORECAST_ENDPOINT = '/forecast';

        // Check if we're using real API key
        const isUsingRealAPI = WEATHER_API_KEY !== 'YOUR_API_KEY_HERE' && WEATHER_API_KEY.length > 10;
        
        // Debug logging
        console.log('Weather API Key configured:', isUsingRealAPI);
        console.log('Weather API Key length:', WEATHER_API_KEY.length);
        if (isUsingRealAPI) {
            console.log('‚úÖ Ready to use OpenWeatherMap API');
        } else {
            console.log('‚ÑπÔ∏è Using demo data - add OpenWeatherMap API key for real forecasts');
        }

        // ========================================
        // DEMO DATA (fallback)
        // ========================================
        const mockWeatherData = {
            "Birmingham, UK": {
                current: { temp: 15, humidity: 65, windSpeed: 12, description: "partly cloudy" },
                forecast: [
                    { 
                        date: "Today", 
                        temp: 18, 
                        humidity: 60, 
                        windSpeed: 15, 
                        precipitation: 10, 
                        description: "partly cloudy",
                        hourly: [
                            { time: "09:00", temp: 16, humidity: 65, windSpeed: 12, precipitation: 5 },
                            { time: "12:00", temp: 18, humidity: 55, windSpeed: 15, precipitation: 0 },
                            { time: "15:00", temp: 19, humidity: 50, windSpeed: 18, precipitation: 0 },
                            { time: "18:00", temp: 17, humidity: 60, windSpeed: 14, precipitation: 10 }
                        ]
                    },
                    { date: "Tomorrow", temp: 22, humidity: 45, windSpeed: 20, precipitation: 0, description: "sunny" },
                    { date: "Day 3", temp: 19, humidity: 70, windSpeed: 8, precipitation: 60, description: "rainy" },
                    { date: "Day 4", temp: 21, humidity: 55, windSpeed: 16, precipitation: 5, description: "partly cloudy" },
                    { date: "Day 5", temp: 24, humidity: 40, windSpeed: 22, precipitation: 0, description: "sunny" }
                ]
            },
            "London, UK": {
                current: { temp: 17, humidity: 70, windSpeed: 10, description: "overcast" },
                forecast: [
                    { date: "Today", temp: 19, humidity: 65, windSpeed: 12, precipitation: 20, description: "overcast" },
                    { date: "Tomorrow", temp: 21, humidity: 50, windSpeed: 18, precipitation: 5, description: "partly cloudy" },
                    { date: "Day 3", temp: 23, humidity: 45, windSpeed: 25, precipitation: 0, description: "sunny" },
                    { date: "Day 4", temp: 18, humidity: 75, windSpeed: 8, precipitation: 80, description: "heavy rain" },
                    { date: "Day 5", temp: 20, humidity: 60, windSpeed: 15, precipitation: 10, description: "light rain" }
                ]
            }
        };

        // ========================================
        // LOCATION LOOKUP FUNCTIONS
        // ========================================
        async function getCoordinatesFromLocation(locationName) {
            const knownLocations = {
                'birmingham': { lat: 52.4862, lon: -1.8904 },
                'birmingham, uk': { lat: 52.4862, lon: -1.8904 },
                'london': { lat: 51.5074, lon: -0.1278 },
                'london, uk': { lat: 51.5074, lon: -0.1278 },
                'manchester': { lat: 53.4808, lon: -2.2426 },
                'manchester, uk': { lat: 53.4808, lon: -2.2426 },
                'leeds': { lat: 53.8008, lon: -1.5491 },
                'bristol': { lat: 51.4545, lon: -2.5879 },
                'liverpool': { lat: 53.4084, lon: -2.9916 },
                'edinburgh': { lat: 55.9533, lon: -3.1883 },
                'glasgow': { lat: 55.8642, lon: -4.2518 },
                'cardiff': { lat: 51.4816, lon: -3.1791 },
                'belfast': { lat: 54.5973, lon: -5.9301 }
            };
            
            const normalized = locationName.toLowerCase().trim();
            return knownLocations[normalized] || knownLocations['birmingham, uk'];
        }

        // ========================================
        // OPENWEATHERMAP API FUNCTIONS
        // ========================================
        async function fetchOpenWeatherData(lat, lon) {
            if (!isUsingRealAPI) {
                console.log('Using demo data - OpenWeatherMap API key not configured');
                return null;
            }

            try {
                // Fetch current weather
                const currentUrl = `${OPENWEATHER_BASE_URL}${CURRENT_WEATHER_ENDPOINT}?` +
                    `lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`;

                // Fetch 5-day forecast
                const forecastUrl = `${OPENWEATHER_BASE_URL}${FORECAST_ENDPOINT}?` +
                    `lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`;

                console.log('Fetching OpenWeatherMap data...');

                const [currentResponse, forecastResponse] = await Promise.all([
                    fetch(currentUrl),
                    fetch(forecastUrl)
                ]);

                if (!currentResponse.ok) {
                    throw new Error(`OpenWeatherMap current weather error: ${currentResponse.status}`);
                }

                if (!forecastResponse.ok) {
                    throw new Error(`OpenWeatherMap forecast error: ${forecastResponse.status}`);
                }

                const currentData = await currentResponse.json();
                const forecastData = await forecastResponse.json();

                console.log('‚úÖ Successfully fetched OpenWeatherMap data');
                return { current: currentData, forecast: forecastData };

            } catch (error) {
                console.error('Error fetching OpenWeatherMap data:', error);
                return null;
            }
        }

        // ========================================
        // DATA PROCESSING FUNCTIONS
        // ========================================
        function processOpenWeatherData(weatherData) {
            if (!weatherData || !weatherData.current || !weatherData.forecast) {
                return null;
            }

            const current = weatherData.current;
            const forecastList = weatherData.forecast.list;

            // Process current conditions
            const currentConditions = {
                temp: Math.round(current.main.temp),
                humidity: current.main.humidity,
                windSpeed: Math.round(current.wind.speed * 3.6), // Convert m/s to km/h
                description: getWeatherDescriptionFromOpenWeather(current.weather[0])
            };

            // Group forecast data by day
            const dailyGroups = {};
            const now = new Date();
            
            forecastList.forEach((item, index) => {
                const date = new Date(item.dt * 1000);
                const dateKey = date.toDateString();
                
                if (!dailyGroups[dateKey]) {
                    dailyGroups[dateKey] = [];
                }
                
                dailyGroups[dateKey].push({
                    time: date.getHours().toString().padStart(2, '0') + ':00',
                    temp: Math.round(item.main.temp),
                    humidity: item.main.humidity,
                    windSpeed: Math.round(item.wind.speed * 3.6),
                    precipitation: Math.round((item.pop || 0) * 100) // Probability of precipitation
                });
            });

            // Create daily forecast summaries
            const forecastData = [];
            const dateKeys = Object.keys(dailyGroups);
            
            dateKeys.forEach((dateKey, index) => {
                const dayData = dailyGroups[dateKey];
                const dayName = index === 0 ? 'Today' : 
                               index === 1 ? 'Tomorrow' : 
                               `Day ${index + 1}`;

                // Calculate daily averages
                const avgTemp = Math.round(dayData.reduce((sum, h) => sum + h.temp, 0) / dayData.length);
                const avgHumidity = Math.round(dayData.reduce((sum, h) => sum + h.humidity, 0) / dayData.length);
                const avgWind = Math.round(dayData.reduce((sum, h) => sum + h.windSpeed, 0) / dayData.length);
                const maxPrecip = Math.max(...dayData.map(h => h.precipitation));

                const dayForecast = {
                    date: dayName,
                    temp: avgTemp,
                    humidity: avgHumidity,
                    windSpeed: avgWind,
                    precipitation: maxPrecip,
                    description: getWeatherDescription({
                        screenTemperature: avgTemp,
                        screenRelativeHumidity: avgHumidity,
                        probOfPrecipitation: maxPrecip / 100
                    })
                };

                // Add hourly data for today
                if (index === 0) {
                    dayForecast.hourly = dayData.slice(0, 8); // Next 8 hours
                }

                forecastData.push(dayForecast);
            });

            return {
                current: currentConditions,
                forecast: forecastData.slice(0, 5) // 5-day forecast
            };
        }

        function getWeatherDescriptionFromOpenWeather(weather) {
            const main = weather.main.toLowerCase();
            const description = weather.description.toLowerCase();
            
            if (main.includes('rain') || description.includes('rain')) {
                if (description.includes('light')) return 'light rain';
                if (description.includes('heavy')) return 'heavy rain';
                return 'rainy';
            }
            
            if (main.includes('cloud')) {
                if (description.includes('few') || description.includes('scattered')) return 'partly cloudy';
                return 'overcast';
            }
            
            if (main.includes('clear') || main.includes('sun')) return 'sunny';
            
            return 'partly cloudy';
        }

        function getWeatherDescription(data) {
            const temp = data.screenTemperature || 15;
            const humidity = data.screenRelativeHumidity || 65;
            const precipProb = (data.probOfPrecipitation || 0) * 100;
            
            if (precipProb > 60) return 'rainy';
            if (precipProb > 30) return 'light rain';
            if (humidity > 80) return 'overcast';
            if (humidity < 50 && temp > 18) return 'sunny';
            return 'partly cloudy';
        }

        // ========================================
        // WASHING PREDICTION FUNCTIONS
        // ========================================
        function calculateWashingScore(temp, humidity, windSpeed, precipitation) {
            let score = 0;
            
            if (temp >= 15 && temp <= 25) {
                score += 25;
            } else if (temp >= 10 && temp <= 30) {
                score += 15;
            } else {
                score += 5;
            }
            
            if (humidity <= 50) {
                score += 30;
            } else if (humidity <= 65) {
                score += 20;
            } else if (humidity <= 80) {
                score += 10;
            } else {
                score += 0;
            }
            
            if (windSpeed >= 10 && windSpeed <= 25) {
                score += 25;
            } else if (windSpeed >= 5 && windSpeed <= 35) {
                score += 15;
            } else {
                score += 5;
            }
            
            if (precipitation <= 5) {
                score += 20;
            } else if (precipitation <= 20) {
                score += 10;
            } else if (precipitation <= 50) {
                score += 5;
            } else {
                score += 0;
            }
            
            return Math.min(score, 100);
        }

        function calculateDryingTime(temp, humidity, windSpeed, fabricType = 'cotton') {
            const baseTimes = {
                'cotton': 4,
                'thick': 6,
                'delicate': 3,
                'bedding': 8
            };
            
            let baseTime = baseTimes[fabricType] || 4;
            
            let tempFactor = 1;
            if (temp >= 20) tempFactor = 0.8;
            else if (temp >= 15) tempFactor = 1.0;
            else if (temp >= 10) tempFactor = 1.3;
            else tempFactor = 1.6;
            
            let humidityFactor = 1;
            if (humidity <= 40) humidityFactor = 0.7;
            else if (humidity <= 55) humidityFactor = 0.9;
            else if (humidity <= 70) humidityFactor = 1.2;
            else humidityFactor = 1.6;
            
            let windFactor = 1;
            if (windSpeed >= 20) windFactor = 0.7;
            else if (windSpeed >= 12) windFactor = 0.8;
            else if (windSpeed >= 6) windFactor = 1.0;
            else windFactor = 1.2;
            
            const totalTime = baseTime * tempFactor * humidityFactor * windFactor;
            return Math.round(totalTime * 10) / 10;
        }

        function formatDryingTime(hours) {
            if (hours >= 24) {
                return `${Math.round(hours / 24 * 10) / 10} days`;
            } else if (hours >= 1) {
                const wholeHours = Math.floor(hours);
                const minutes = Math.round((hours - wholeHours) * 60);
                if (minutes === 0) {
                    return `${wholeHours}h`;
                } else {
                    return `${wholeHours}h ${minutes}m`;
                }
            } else {
                return `${Math.round(hours * 60)}m`;
            }
        }

        function getSafeOutdoorTime(forecast, startHour = 9) {
            let safeHours = 0;
            
            if (forecast[0] && forecast[0].hourly) {
                for (let hour of forecast[0].hourly) {
                    if (parseInt(hour.time.split(':')[0]) >= startHour) {
                        if (hour.precipitation > 20) {
                            break;
                        }
                        safeHours++;
                    }
                }
                
                if (safeHours >= (24 - startHour)) {
                    for (let i = 1; i < forecast.length; i++) {
                        if (forecast[i].precipitation > 20) {
                            break;
                        }
                        safeHours += 12;
                    }
                }
            } else {
                for (let day of forecast) {
                    if (day.precipitation > 20) {
                        break;
                    }
                    safeHours += 12;
                }
            }
            
            return Math.max(safeHours, 2);
        }

        function getScoreCategory(score) {
            if (score >= 80) return { category: 'excellent', label: 'Excellent' };
            if (score >= 60) return { category: 'good', label: 'Good' };
            if (score >= 40) return { category: 'fair', label: 'Fair' };
            return { category: 'poor', label: 'Poor' };
        }

        function getWeatherIcon(description) {
            const icons = {
                'sunny': '‚òÄÔ∏è',
                'partly cloudy': '‚õÖ',
                'overcast': '‚òÅÔ∏è',
                'rainy': 'üåßÔ∏è',
                'light rain': 'üå¶Ô∏è',
                'heavy rain': '‚õàÔ∏è'
            };
            return icons[description] || 'üå§Ô∏è';
        }

        function getWindVisualization(windSpeed) {
            let level = 1;
            let description = '';
            let emoji = '';
            
            if (windSpeed <= 5) {
                level = 1;
                description = 'Calm';
                emoji = 'üçÉ';
            } else if (windSpeed <= 12) {
                level = 2;
                description = 'Light breeze';
                emoji = 'üå¨Ô∏è';
            } else if (windSpeed <= 20) {
                level = 3;
                description = 'Moderate';
                emoji = 'üí®';
            } else if (windSpeed <= 30) {
                level = 4;
                description = 'Strong breeze';
                emoji = 'üå™Ô∏è';
            } else {
                level = 5;
                description = 'Strong wind';
                emoji = '‚õàÔ∏è';
            }
            
            const bars = Array.from({length: 5}, (_, i) => 
                `<div class="wind-bar${i < level ? ' active' : ''}"></div>`
            ).join('');
            
            return `
                <div class="wind-indicator">
                    ${emoji}
                    <div class="wind-bars wind-level-${level}">
                        ${bars}
                    </div>
                    <span class="wind-speed">${windSpeed} km/h</span>
                    <span class="wind-description">${description}</span>
                </div>
            `;
        }

        function findBestTimes(forecast, fabricType = 'cotton') {
            const bestTimes = [];
            
            if (forecast[0].hourly) {
                forecast[0].hourly.forEach(hour => {
                    const score = calculateWashingScore(hour.temp, hour.humidity, hour.windSpeed, hour.precipitation);
                    if (score >= 60) {
                        const dryingTime = calculateDryingTime(hour.temp, hour.humidity, hour.windSpeed, fabricType);
                        const safeTime = getSafeOutdoorTime(forecast, parseInt(hour.time.split(':')[0]));
                        
                        bestTimes.push({
                            time: `Today ${hour.time}`,
                            score: score,
                            conditions: `${hour.temp}¬∞C, ${hour.humidity}% humidity, ${getWindVisualization(hour.windSpeed)}`,
                            dryingTime: dryingTime,
                            safeTime: safeTime,
                            canFullyDry: dryingTime <= safeTime
                        });
                    }
                });
            }
            
            forecast.slice(1).forEach(day => {
                const score = calculateWashingScore(day.temp, day.humidity, day.windSpeed, day.precipitation);
                if (score >= 60) {
                    const dryingTime = calculateDryingTime(day.temp, day.humidity, day.windSpeed, fabricType);
                    const safeTime = getSafeOutdoorTime([day], 9);
                    
                    bestTimes.push({
                        time: day.date,
                        score: score,
                        conditions: `${day.temp}¬∞C, ${day.humidity}% humidity, ${getWindVisualization(day.windSpeed)}`,
                        dryingTime: dryingTime,
                        safeTime: safeTime,
                        canFullyDry: dryingTime <= safeTime
                    });
                }
            });
            
            return bestTimes.sort((a, b) => b.score - a.score).slice(0, 3);
        }

        function getWashingTips(forecast) {
            const tips = [];
            
            const avgHumidity = forecast.reduce((sum, day) => sum + day.humidity, 0) / forecast.length;
            const avgWind = forecast.reduce((sum, day) => sum + day.windSpeed, 0) / forecast.length;
            const rainyDays = forecast.filter(day => day.precipitation > 20).length;
            
            if (avgHumidity > 70) {
                tips.push("High humidity expected - consider using indoor drying or wait for drier conditions");
            }
            
            if (avgWind > 20) {
                tips.push("Strong winds forecasted - secure lighter items well or bring them inside");
            }
            
            if (rainyDays > 2) {
                tips.push("Several rainy days ahead - plan indoor drying alternatives");
            }
            
            if (avgHumidity < 50 && avgWind > 10) {
                tips.push("Great drying conditions! Perfect time to wash heavier items like bedding");
            }
            
            tips.push("For fastest drying, hang clothes in single layers with good air circulation");
            tips.push("Turn dark clothes inside out to prevent fading in direct sunlight");
            
            return tips;
        }

        // ========================================
        // MAIN APPLICATION FUNCTION
        // ========================================
        async function getWeatherForecast() {
            const location = document.getElementById('locationInput').value.trim();
            const fabricType = document.getElementById('fabricType').value;
            const resultsDiv = document.getElementById('results');
            
            if (!location) {
                resultsDiv.innerHTML = '<div class="error">Please enter a location</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div class="loading">Fetching weather data for optimal washing times...</div>';
            
            try {
                const coords = await getCoordinatesFromLocation(location);
                
                const [hourlyData, threeHourlyData] = await Promise.all([
                    fetchMetOfficeHourlyData(coords.lat, coords.lon),
                    fetchMetOfficeThreeHourlyData(coords.lat, coords.lon)
                ]);
                
                let weatherData;
                
                if (hourlyData) {
                    weatherData = processMetOfficeData(hourlyData, threeHourlyData);
                    console.log('Using real Met Office data for', location);
                }
                
                if (!weatherData) {
                    weatherData = mockWeatherData[location] || mockWeatherData["Birmingham, UK"];
                    console.log('Using demo data for', location);
                }
                
                const bestTimes = findBestTimes(weatherData.forecast, fabricType);
                const tips = getWashingTips(weatherData.forecast);
                
                let html = '';
                
                const dataSource = hourlyData ? 
                    '<div class="api-status api-live">üì° Live Met Office Data</div>' :
                    '<div class="api-status api-demo">üé≠ Demo Data - Deploy with API key for real forecasts</div>';
                
                html += dataSource;
                
                if (bestTimes.length > 0) {
                    const fabricSelect = document.getElementById('fabricType');
                    const fabricText = fabricSelect.options[fabricSelect.selectedIndex].text.toLowerCase();
                    
                    html += `
                        <div class="best-times">
                            <h2>üéØ Best Times to Hang Washing</h2>
                            <p>Optimal times for ${fabricText}:</p>
                            <div class="time-slots">
                    `;
                    
                    bestTimes.forEach(time => {
                        const scoreInfo = getScoreCategory(time.score);
                        const safeIndicator = time.canFullyDry ? 
                            `<span class="safe-indicator safe-yes">‚úì Will dry completely</span>` :
                            `<span class="safe-indicator safe-partial">‚ö† May need bringing in</span>`;
                        
                        html += `
                            <div class="time-slot ${scoreInfo.category}">
                                <h3>${time.time}</h3>
                                <div class="washing-score score-${scoreInfo.category}">${scoreInfo.label} (${time.score}/100)</div>
                                <p>${time.conditions}</p>
                                <div class="time-info">
                                    <div><strong>üïê Drying time:</strong> ${formatDryingTime(time.dryingTime)}</div>
                                    <div><strong>‚òî Safe outside:</strong> ${formatDryingTime(time.safeTime)}</div>
                                    <div class="drying-estimate">
                                        ${safeIndicator}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                } else {
                    html += `
                        <div class="best-times" style="background: linear-gradient(135deg, #e17055, #fd79a8);">
                            <h2>‚ö†Ô∏è Poor Washing Conditions</h2>
                            <p>Weather conditions aren't ideal for outdoor drying in the next few days. Consider indoor alternatives.</p>
                        </div>
                    `;
                }
                
                html += '<div class="forecast-grid">';
                processedData.forecast.forEach(day => {
                    const score = calculateWashingScore(day.temp, day.humidity, day.windSpeed, day.precipitation);
                    const scoreInfo = getScoreCategory(score);
                    const icon = getWeatherIcon(day.description);
                    const dryingTime = calculateDryingTime(day.temp, day.humidity, day.windSpeed, fabricType);
                    const safeTime = getSafeOutdoorTime([day], 9);
                    
                    html += `
                        <div class="day-card">
                            <div class="day-header">
                                <h3>${day.date}</h3>
                                <span class="washing-score score-${scoreInfo.category}">${score}/100</span>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <span class="weather-icon">${icon}</span>
                                <div>
                                    <div style="font-weight: bold;">${day.temp}¬∞C</div>
                                    <div style="text-transform: capitalize; color: #666;">${day.description}</div>
                                </div>
                            </div>
                            <div class="weather-details">
                                <div class="detail-item">üíß ${day.humidity}% humidity</div>
                                <div class="detail-item">${getWindVisualization(day.windSpeed)}</div>
                                <div class="detail-item">üåßÔ∏è ${day.precipitation}% rain</div>
                                <div class="detail-item">üëï ${scoreInfo.label} for drying</div>
                                <div class="detail-item">üïê ${formatDryingTime(dryingTime)} to dry</div>
                                <div class="detail-item">‚òî ${formatDryingTime(safeTime)} safe outside</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                html += `
                    <div class="tips">
                        <h3>üéØ Smart Drying Tips</h3>
                        <ul>
                `;
                tips.forEach(tip => {
                    html += `<li>${tip}</li>`;
                });
                html += '</ul></div>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Error getting weather forecast:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> Could not fetch weather data. ${error.message}
                        <br><br>
                        Please try again or contact support if the issue persists.
                    </div>
                `;
            }
        }

        // ========================================
        // INITIALIZATION
        // ========================================
        window.addEventListener('load', () => {
            getWeatherForecast();
        });
        
        document.getElementById('locationInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                getWeatherForecast();
            }
        });
    </script>
</body>
</html>